## Быстрое руководство для AI-агента (коротко и по делу)
```instructions
## Быстрое руководство для AI-агента (коротко и по делу)

Этот репозиторий очень маленький — он содержит утилиту-скрипт для быстрой настройки SWAP на серверный Linux.
Ниже — конкретные, проверяемые факты и указания, которые помогут быстро вносить корректные правки.

- Основной файл: `swap_mini.sh` — bash-скрипт, рассчитан на запуск от root. Содержит ANSI-переменные цветов и русские сообщения для пользователя.
- Документ с описанием: `README.md` (на русском) — содержит краткое назначение скрипта.

Ключевые детали кода (чтобы не поломать поведение):
- Скрипт проверяет root через `$EUID` и аварийно завершает с `exit 1` при ошибках. Сохраняйте эту логику при рефакторинге.
- Скрипт использует `df -BG --output=avail /` и `/proc/meminfo` для вычислений свободного места и размера swap. Любые изменения логики проверки диска/памяти должны оставлять эквивалентную валидацию.
- Скрипт меняет системные состояния: выключает swap (`swapoff -a`), создает `/swapfile` через `dd`, делает `mkswap`, добавляет строку в `/etc/fstab` и включает swap (`swapon`). Обновления должны учитывать безопасность (права `chmod 600 /swapfile`) и откат при ошибках.

Цели PR/правок, которые обычно ожидаются здесь:
- Исправление ошибок в проверках (например, валидация числового ввода `swap_size`).
- Улучшение сообщений об ошибках (сохранить русскую локаль и переменные цветов).
- Небольшие улучшения безопасности (проверка успешности `dd`, атомарное изменение `/etc/fstab` и т.п.).

Как тестировать изменения локально (обязательно и в явной форме):
1. Тестируйте в изолированной VM или контейнере Ubuntu 22.04 (не на реальном проде). Скрипт модифицирует `/etc/fstab` и создаёт `/swapfile`.
2. Запустить под root: `sudo bash swap_mini.sh` и пройти интерактивный сценарий.
3. Проверки после выполнения: `swapon -s` (ищите `/swapfile`) и `grep /swapfile /etc/fstab`.
4. Для безопасного теста можно вручную выполнить шаги: `dd` -> `chmod` -> `mkswap` -> `swapon`, чтобы отладить часть без редактирования fstab.

Проектные соглашения, которые важно соблюдать при автоматических изменениях:
- Сообщения в скрипте на русском — новые/изменённые выводы тоже должны быть на русском.
- Оставляйте и используйте существующие переменные цвета (например, `b`, `l`, `y`, `g`, `r`, `e`) — это часть UX скрипта.
- Скрипт использует простую процедурную структуру (однофайловый bash). Не переводите имплементацию в сложный фреймворк без явного обсуждения.

Безопасность и интеграция:
- Скрипт напрямую редактирует `/etc/fstab` — при изменении логики обновления fstab используйте безопасный подход (например, проверять наличие строки перед добавлением и делать резервную копию).
- Нет внешних зависимостей (нет package.json / requirements.txt). Все изменения ограничены shell-инструментами (coreutils, util-linux).

Если вы редактируете скрипт, включите в PR краткое тестовое руководство (кратко перечислите шаги проверки) и укажите, какие edge-cases вы проверили (недостаток места, некорректный ввод размера и т.п.).

Пример конкретного упоминания в PR:
"Изменил валидацию `swap_size` в `swap_mini.sh` — теперь игнорирует ведущие нули и выводит понятную ошибку; тестировал в VM Ubuntu 22.04, `swapon -s` показывает `/swapfile`, `/etc/fstab` содержит запись".

Если что-то непонятно или нужно больше контекста — скажите, я обновлю эту инструкцию под ваши предпочтения (например, добавить шаблон PR или checklist для ручного тестирования).

## Рекомендации по подбору размера swap (коротко и практично)

- Минимальный практический размер: 128–512 MB (128 MB — крайний минимум; 512 MB — более безопасно для серверов с маленькой RAM).
- Общие рекомендации:
	- Лёгкая серверная подстраховка: 512 MB — 2 GB.
	- Виртуальные машины с небольшой RAM (≤2 GB): рекомендуем 1×–2× RAM или минимум 1 GB.
	- Серверы с большой RAM (>16 GB): 1–4 GB обычно достаточно.
- Максимальный размер обычно ограничен свободным местом на диске; для большинства 64‑бит серверов практических ограничений нет.


## Как применять рекомендации в коде (что стоит сделать в PR)

- Всегда проверяйте свободное место перед созданием swap (в скрипте используется `df -BG` / `df -BM`). В PR добавьте проверку в MB/GB и ясный вывод для пользователя.
- Небольшие, полезные фичи для реализации:
	- `--suggest-size` — вычисляет рекомендуемый размер swap по объёму RAM (простая формула: RAM ≤2GB → 1×RAM; RAM >2GB → 1–2 GB).
	- Настраиваемые пороги валидации: минимальный допустимый swap (по умолчанию 128 MB) и предупреждение при слишком большим swap (>50% свободного диска).
	- `--unit-name` для systemd unit, чтобы избежать конфликтов при одинаковых basename в путях.
	- `--list-langs` и поддержка переменной окружения (например, `SWAP_LANG`) для CI — автоматический выбор языка.

## Тестирование и dry-run

- При `-n/--dry-run` скрипт должен симулировать все действия: проверять дисковое пространство, валидировать ввод, показывать команды, которые он бы выполнил, и не вносить изменений в `/etc/fstab` или systemd.
- Для CI удобно иметь симуляцию: при dry-run можно создать временный файл в `/tmp` и временный unit (без enable), чтобы прогнать логику без изменения системы.

## Область применения

- Этот проект предназначен исключительно для серверных Linux-дистрибутивов (Ubuntu/Debian/CentOS/RHEL/Alma/Rocky и т.п.). Не расширяйте поддержку на macOS/BSD в том же модуле — для них нужен отдельный инструмент.
После внесения изменений добавляйте в PR короткий тестовый сценарий (dry-run + реальный запуск в изолированной VM) и указывайте, какие edge-cases вы проверяли.

```
